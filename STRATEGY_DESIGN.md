# Polymarket 订单簿闪崩反弹策略设计需求

本策略旨在捕捉 Polymarket 订单簿中的瞬时大幅下跌（闪崩）并在反弹时获利。

## 核心逻辑流程

### 1. 状态机模型
程序运行过程中，每个资产（BTC/ETH/SOL/XRP）的每个方向（Up/Down）都处于以下两个状态之一：

*   **状态 A：探测买入机会阶段 (Phase A)**
    *   初始状态。
    *   持续监测价格波动。
*   **状态 B：探测卖出机会阶段 (Phase B)**
    *   触发买入后进入此状态。
    *   停止探测闪崩，转为监测持仓盈亏。

---

### 2. 闪崩探测与买入 (状态 A)
*   **闪崩定义**：在设定的滑动窗口（默认 10s）内，最新价格相比该窗口内的最高价格下跌达到阈值（默认 0.08）。
*   **关键概念**：
    *   **锚定价格 (Anchor Price)**：滑动窗口内的最高价格。
    *   **锚定时间 (Anchor Time)**：锚定价格出现的时间点。
    *   **买入价格 (Buy Price)**：触发闪崩阈值时的最新价格。
    *   **买入时间 (Buy Time)**：触发买入的时间点。
*   **动作**：一旦触发闪崩，记录上述四个关键数据，并立即进入 **状态 B**。

---

### 3. 反弹监测与卖出 (状态 B)
进入状态 B 后，程序只监测以下三种情况以触发卖出动作：

*   **止盈 (Take Profit)**：
    *   定义：最新价格 $\ge$ 买入价格 $+$ 止盈距离（默认 0.05）。
    *   记录：止盈价格（即最新价）、卖出时间。
*   **止损 (Stop Loss)**：
    *   定义：最新价格 $\le$ 买入价格 $-$ 止损距离（默认 0.05）。
    *   记录：止损价格（即最新价）、卖出时间。
*   **清仓 (Liquidation)**：
    *   定义：进入市场最后一分钟（见下文“时间阶段控制”）。
    *   记录：卖出价格（即最新价）、卖出时间。

**动作**：触发任一卖出条件后，记录数据，清空当前事件追踪，重新回到 **状态 A**。

---

### 4. 时间阶段控制 (Time-Based Phases)
每个 15 分钟的市场轮次（窗口）被划分为三个阶段：

1.  **正常交易阶段 (T-15m 至 T-3m)**：
    *   正常进行状态 A 和状态 B 的转换。
2.  **停止买入阶段 (T-3m 至 T-1m)**：
    *   停止嗅探闪崩，不再进入新的“状态 B”。
    *   如果已处于“状态 B”，则继续保持并监测卖出机会。
3.  **清仓阶段 (T-1m 至 结束)**：
    *   强制清仓：无论价格如何，所有处于“状态 B”的仓位必须立即卖出并记录。

---

## 数据保存
所有策略执行记录保存在 `rebound.csv` 中，包含以下字段：
`window_start, asset, direction, anchor_time, anchor_price, buy_time, buy_price, sell_time, sell_price, status`
